<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc reference="MOOC.Code.MOOCSheet" locale="">
  <web>MOOC.Code</web>
  <name>MOOCSheet</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>MOOCClass</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1469613411000</creationDate>
  <date>1472806548000</date>
  <contentUpdateDate>1472806548000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <attachment>
    <filename>VISH.IframeAPI.js</filename>
    <filesize>17111</filesize>
    <author>xwiki:XWiki.Admin</author>
    <date>1472804959000</date>
    <version>1.1</version>
    <comment/>
    <content>LyoNCiAqIFZJU0ggSWZyYW1lIE1lc3NlbmdlciBBUEkNCiAqIFByb3ZpZGVzIGFuIEFQSSB0aGF0
IGFsbG93cyB3ZWIgYXBwbGljYXRpb25zIHRvIGNvbW11bmljYXRlIHdpdGggVmlTSCBFZGl0b3IN
CiAqIEBhdXRob3IgR0lORw0KICogQHZlcnNpb24gMi4wDQogKi8NCg0KdmFyIFZJU0ggPSBWSVNI
IHx8IHt9Ow0KDQoNClZJU0guSWZyYW1lQVBJID0gKGZ1bmN0aW9uKFYsdW5kZWZpbmVkKXsNCg0K
CXZhciBfaW5pdGlhbGl6ZWQgPSBmYWxzZTsNCgl2YXIgX2Nvbm5lY3RlZCA9IGZhbHNlOw0KCXZh
ciBfb3B0aW9uczsNCgl2YXIgX21vZGUgPSAiRVhURVJOQUwiOyAvL2RlZmF1bHQNCgl2YXIgX29y
aWdpbiA9ICI/IjsNCgl2YXIgX29yaWdpbklkID0gIj8iOw0KCXZhciBfbGlzdGVuZXJzOw0KCXZh
ciBfd2FwcGxpc3RlbmVyczsNCgkvLyBfbGlzdGVuZXJzWydldmVudCddID0gY2FsbGJhY2s7DQoN
CgkvL0NvbnN0YW50cw0KCXZhciBWQUxJRF9UWVBFUyA9IFsiUFJPVE9DT0wiLCJWRSIsIldBUFAi
XTsNCg0KDQoJLy8vLy8vLy8vLy8vLy8vDQoJLy8gQ09SRQ0KCS8vLy8vLy8vLy8vLy8vDQoNCgl2
YXIgaW5pdCA9IGZ1bmN0aW9uKGluaXRPcHRpb25zKXsNCgkJX2Nvbm5lY3RlZCA9IGZhbHNlOw0K
DQoJCWlmKF9pbml0aWFsaXplZD09PWZhbHNlKXsNCgkJCXRyeSB7DQoJCQkJX29yaWdpbiA9IHdp
bmRvdy5sb2NhdGlvbi5ocmVmOw0KCQkJfSBjYXRjaCAoZSl7fQ0KCQkJX29yaWdpbklkID0gX2dl
bmVyYXRlT3JpZ2luSWQoKTsNCg0KCQkJaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKXsNCgkJ
CQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIF9vbklmcmFtZU1lc3NhZ2VSZWNl
aXZlZCwgZmFsc2UpOw0KCQkJfSBlbHNlIGlmICh3aW5kb3cuYXR0YWNoRXZlbnQpew0KCQkJCXdp
bmRvdy5hdHRhY2hFdmVudCgibWVzc2FnZSIsIF9vbklmcmFtZU1lc3NhZ2VSZWNlaXZlZCk7DQoJ
CQl9DQoNCgkJCV9kZWZpbmVWRUNvbnN0YW50cygpOw0KCQl9DQoJCV9pbml0aWFsaXplZCA9IHRy
dWU7DQoNCgkJX29wdGlvbnMgPSBpbml0T3B0aW9ucyB8fCB7fTsNCg0KCQlpZihbIkVYVEVSTkFM
IiwiSU5URVJOQUwiXS5pbmRleE9mKF9vcHRpb25zLm1vZGUpIT0tMSl7DQoJCQlfbW9kZSA9IF9v
cHRpb25zLm1vZGU7DQoJCX0NCg0KCQlpZihfb3B0aW9ucy53YXBwPT09dHJ1ZSl7DQoJCQlfbW9k
ZSA9ICJJTlRFUk5BTCI7DQoJCX0gZWxzZSBpZihfb3B0aW9ucy52ZT09PXRydWUpew0KCQkJX21v
ZGUgPSAiRVhURVJOQUwiOw0KCQl9DQoNCgkJaWYoKF9vcHRpb25zLnRyYWNraW5nPT09dHJ1ZSkm
JihfbW9kZSA9ICJJTlRFUk5BTCIpKXsNCgkJCWVuYWJsZVRyYWNrZXIoKTsNCgkJfQ0KDQoJCV9s
aXN0ZW5lcnMgPSBuZXcgQXJyYXkoKTsNCgkJX3dhcHBsaXN0ZW5lcnMgPSBuZXcgQXJyYXkoKTsN
Cg0KCQlyZWdpc3RlckNhbGxiYWNrKCJvbkNvbm5lY3QiLCBmdW5jdGlvbihvcmlnaW4pew0KDQoJ
CQkvL0NvbW11bmljYXRpb24gc3RhYmxpc2hlZA0KCQkJLy8gX3ByaW50KF9vcmlnaW5JZCArICI6
IENvbW11bmljYXRpb24gc3RhYmxpc2hlZCB3aXRoOiAiICsgb3JpZ2luKTsNCg0KCQkJaWYoX21v
ZGU9PT0iRVhURVJOQUwiKXsNCgkJCQlfYWZ0ZXJDb25uZWN0RXh0ZXJuYWwob3JpZ2luKTsNCgkJ
CX0NCg0KCQkJaWYoKF9vcHRpb25zKSYmKHR5cGVvZiBfb3B0aW9ucy5jYWxsYmFjayA9PT0gImZ1
bmN0aW9uIikpew0KCQkJCV9vcHRpb25zLmNhbGxiYWNrKG9yaWdpbik7DQoJCQl9DQoJCX0pOw0K
DQoJCV9pbml0SGVsbG9FeGNoYW5nZSgpOw0KCX07DQoNCg0KCS8vIE1lc3NhZ2VzDQoNCglmdW5j
dGlvbiBJZnJhbWVNZXNzYWdlKHR5cGUsZGF0YSxkZXN0aW5hdGlvbixkZXN0aW5hdGlvbklkKXsN
CgkJdGhpcy5JZnJhbWVNZXNzYWdlID0gdHJ1ZTsNCgkJdGhpcy5tb2RlID0gX21vZGU7DQoJCXRo
aXMudHlwZSA9IHR5cGUgfHwgX21vZGU7DQoJCXRoaXMuZGF0YSA9IGRhdGEgfHwge307DQoJCXRo
aXMub3JpZ2luID0gX29yaWdpbjsNCgkJdGhpcy5vcmlnaW5JZCA9IF9vcmlnaW5JZDsNCgkJdGhp
cy5kZXN0aW5hdGlvbiA9IGRlc3RpbmF0aW9uIHx8ICIqIjsNCgkJaWYoZGVzdGluYXRpb25JZCl7
DQoJCQl0aGlzLmRlc3RpbmF0aW9uSWQgPSBkZXN0aW5hdGlvbklkOw0KCQl9DQoJfTsNCg0KCXZh
ciBfY3JlYXRlTWVzc2FnZSA9IGZ1bmN0aW9uKHR5cGUsZGF0YSxkZXN0aW5hdGlvbixkZXN0aW5h
dGlvbklkKXsNCgkJdmFyIGlmcmFtZU1lc3NhZ2UgPSBuZXcgSWZyYW1lTWVzc2FnZSh0eXBlLGRh
dGEsZGVzdGluYXRpb24sZGVzdGluYXRpb25JZCk7DQoJCXJldHVybiBKU09OLnN0cmluZ2lmeShp
ZnJhbWVNZXNzYWdlKTsNCgl9Ow0KDQoJdmFyIF92YWxpZGF0ZVdyYXBwZXJlZElmcmFtZU1lc3Nh
Z2UgPSBmdW5jdGlvbih3cmFwcGVyZWRJZnJhbWVNZXNzYWdlKXsNCgkJaWYoKHR5cGVvZiB3cmFw
cGVyZWRJZnJhbWVNZXNzYWdlICE9ICJvYmplY3QiKXx8KHR5cGVvZiB3cmFwcGVyZWRJZnJhbWVN
ZXNzYWdlLmRhdGEgIT0gInN0cmluZyIpKXsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCQlyZXR1
cm4gX3ZhbGlkYXRlSWZyYW1lTWVzc2FnZSh3cmFwcGVyZWRJZnJhbWVNZXNzYWdlLmRhdGEpOw0K
CX07DQoNCgl2YXIgX3ZhbGlkYXRlSWZyYW1lTWVzc2FnZSA9IGZ1bmN0aW9uKGlmcmFtZU1lc3Nh
Z2Upew0KCQl0cnkgew0KCQkJdmFyIGlmcmFtZU1lc3NhZ2UgPSBKU09OLnBhcnNlKGlmcmFtZU1l
c3NhZ2UpOw0KCQkJaWYoKGlmcmFtZU1lc3NhZ2UuSWZyYW1lTWVzc2FnZSE9PXRydWUpfHwoVkFM
SURfVFlQRVMuaW5kZXhPZihpZnJhbWVNZXNzYWdlLnR5cGUpPT0tMSkpew0KCQkJCXJldHVybiBm
YWxzZTsNCgkJCX0NCgkJfSBjYXRjaCAoZSl7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCg0KCQly
ZXR1cm4gdHJ1ZTsNCgl9Ow0KDQoNCgkvLyBFdmVudHMgYW5kIGNhbGxiYWNrcw0KDQoJdmFyIHJl
Z2lzdGVyQ2FsbGJhY2sgPSBmdW5jdGlvbihsaXN0ZW5lZEV2ZW50LGNhbGxiYWNrKXsNCgkJaWYo
Y2FsbGJhY2spew0KCQkJX2xpc3RlbmVyc1tsaXN0ZW5lZEV2ZW50XSA9IGNhbGxiYWNrOw0KCQl9
DQoJfTsNCg0KCXZhciB1blJlZ2lzdGVyQ2FsbGJhY2sgPSBmdW5jdGlvbihsaXN0ZW5lZEV2ZW50
KXsNCgkJaWYoKGxpc3RlbmVkRXZlbnQgaW4gX2xpc3RlbmVycykpew0KCQkJX2xpc3RlbmVyc1ts
aXN0ZW5lZEV2ZW50XSA9IG51bGw7DQoJCX0NCgl9Ow0KDQoNCgkvLyBJZnJhbWUgY29tbXVuaWNh
dGlvbiBtZXRob2RzDQoNCgl2YXIgc2VuZE1lc3NhZ2UgPSBmdW5jdGlvbihpZnJhbWVNZXNzYWdl
LGlmcmFtZUlkKXsNCgkJaWYoIV9jb25uZWN0ZWQpew0KCQkJcmV0dXJuICJOb3QgY29ubmVjdGVk
IjsNCgkJfQ0KDQoJCXJldHVybiBfc2VuZE1lc3NhZ2UoaWZyYW1lTWVzc2FnZSxpZnJhbWVJZCk7
DQoJfTsNCg0KCXZhciBfc2VuZE1lc3NhZ2UgPSBmdW5jdGlvbihpZnJhbWVNZXNzYWdlLGlmcmFt
ZUlkKXsNCgkJaWYoIV92YWxpZGF0ZUlmcmFtZU1lc3NhZ2UoaWZyYW1lTWVzc2FnZSkpew0KCQkJ
cmV0dXJuICJJbnZhbGlkIG1lc3NhZ2UiOw0KCQl9DQoNCgkJc3dpdGNoKF9tb2RlKXsNCgkJCWNh
c2UgIkVYVEVSTkFMIjoNCgkJCQlyZXR1cm4gX3NlbmRJbnRlcm5hbE1lc3NhZ2UoaWZyYW1lTWVz
c2FnZSxpZnJhbWVJZCk7DQoJCQljYXNlICJJTlRFUk5BTCI6DQoJCQkJcmV0dXJuIF9zZW5kRXh0
ZXJuYWxNZXNzYWdlKGlmcmFtZU1lc3NhZ2UpOw0KCQkJZGVmYXVsdDoNCgkJCQlyZXR1cm47DQoJ
CX0NCgl9Ow0KDQoJdmFyIF9zZW5kRXh0ZXJuYWxNZXNzYWdlID0gZnVuY3Rpb24oaWZyYW1lTWVz
c2FnZSkgew0KCQl3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKGlmcmFtZU1lc3NhZ2UsJyonKTsN
Cgl9Ow0KDQoJdmFyIF9zZW5kSW50ZXJuYWxNZXNzYWdlID0gZnVuY3Rpb24oaWZyYW1lTWVzc2Fn
ZSxpZnJhbWVJZCl7DQoJCWlmKHR5cGVvZiBpZnJhbWVJZCA9PSAidW5kZWZpbmVkIil7DQoJCQlf
YnJvYWRjYXN0SW50ZXJuYWxNZXNzYWdlKGlmcmFtZU1lc3NhZ2UpOw0KCQl9IGVsc2Ugew0KCQkJ
aWYodHlwZW9mIGlmcmFtZUlkID09PSAic3RyaW5nIil7DQoJCQkJdmFyIGlmcmFtZSA9IGRvY3Vt
ZW50LmdldEVsZW1lbnRCeUlkKGlmcmFtZUlkKTsNCgkJCQlfc2VuZE1lc3NhZ2VUb0lmcmFtZShp
ZnJhbWVNZXNzYWdlLGlmcmFtZSk7DQoJCQl9IGVsc2UgaWYoKGlmcmFtZUlkIGluc3RhbmNlb2Yg
QXJyYXkpJiYoaWZyYW1lSWQubGVuZ3RoID4gMCkpew0KCQkJCWZvcih2YXIgaT0wOyBpPGlmcmFt
ZUlkLmxlbmd0aDsgaSsrKXsNCgkJCQkJaWYodHlwZW9mIGlmcmFtZUlkW2ldID09ICJzdHJpbmci
KXsNCgkJCQkJCXZhciBpZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZnJhbWVJZFtp
XSk7DQoJCQkJCQlfc2VuZE1lc3NhZ2VUb0lmcmFtZShpZnJhbWVNZXNzYWdlLGlmcmFtZSk7DQoJ
CQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCgl9Ow0KDQoJdmFyIF9icm9hZGNhc3RJbnRlcm5hbE1l
c3NhZ2UgPSBmdW5jdGlvbihpZnJhbWVNZXNzYWdlKXsNCgkJdmFyIGFsbFZFSWZyYW1lcyA9IGRv
Y3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImlmcmFtZSIpOw0KCQlmb3IodmFyIGk9MDsgaTxhbGxW
RUlmcmFtZXMubGVuZ3RoOyBpKyspew0KCQkJX3NlbmRNZXNzYWdlVG9JZnJhbWUoaWZyYW1lTWVz
c2FnZSxhbGxWRUlmcmFtZXNbaV0pOw0KCQl9DQoJfTsNCg0KCXZhciBfc2VuZE1lc3NhZ2VUb0lm
cmFtZSA9IGZ1bmN0aW9uKGlmcmFtZU1lc3NhZ2UsaWZyYW1lKXsNCgkJaWYoKGlmcmFtZSkmJihp
ZnJhbWUuY29udGVudFdpbmRvdykpew0KCQkJaWZyYW1lLmNvbnRlbnRXaW5kb3cucG9zdE1lc3Nh
Z2UoaWZyYW1lTWVzc2FnZSwnKicpOw0KCQl9DQoJfTsNCg0KCXZhciBfb25JZnJhbWVNZXNzYWdl
UmVjZWl2ZWQgPSBmdW5jdGlvbih3cmFwcGVyZWRJZnJhbWVNZXNzYWdlKXsNCg0KCQlpZihfdmFs
aWRhdGVXcmFwcGVyZWRJZnJhbWVNZXNzYWdlKHdyYXBwZXJlZElmcmFtZU1lc3NhZ2UpKXsNCg0K
CQkJdmFyIGlmcmFtZU1lc3NhZ2UgPSBKU09OLnBhcnNlKHdyYXBwZXJlZElmcmFtZU1lc3NhZ2Uu
ZGF0YSk7DQoNCgkJCWlmKChpZnJhbWVNZXNzYWdlLmRlc3RpbmF0aW9uIT1fb3JpZ2luKSYmKGlm
cmFtZU1lc3NhZ2UuZGVzdGluYXRpb24hPT0iKiIpKXsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJ
CWlmKCh0eXBlb2YgaWZyYW1lTWVzc2FnZS5kZXN0aW5hdGlvbklkICE9ICJ1bmRlZmluZWQiKSYm
KGlmcmFtZU1lc3NhZ2UuZGVzdGluYXRpb25JZCAhPSBfb3JpZ2luSWQpKXsNCgkJCQlyZXR1cm47
DQoJCQl9DQoNCgkJCS8vRG8gbm90IHByb2Nlc3Mgb3duIG1lc3NhZ2VzDQoJCQlpZigoaWZyYW1l
TWVzc2FnZS5vcmlnaW49PT1fb3JpZ2luKSYmKGlmcmFtZU1lc3NhZ2Uub3JpZ2luSWQ9PT1fb3Jp
Z2luSWQpKXsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoNCgkJCXN3aXRjaChpZnJhbWVNZXNz
YWdlLnR5cGUpIHsNCgkJCQljYXNlICJQUk9UT0NPTCI6DQoJCQkJCXJldHVybiBfcHJvY2Vzc1By
b3RvY29sTWVzc2FnZShpZnJhbWVNZXNzYWdlKTsNCgkJCQljYXNlICJWRSI6DQoJCQkJCXJldHVy
biBfcHJvY2Vzc1ZFTWVzc2FnZShpZnJhbWVNZXNzYWdlKTsNCgkJCQljYXNlICJXQVBQIjoNCgkJ
CQkJcmV0dXJuIF9wcm9jZXNzV0FQUE1lc3NhZ2UoaWZyYW1lTWVzc2FnZSk7DQoJCQkJZGVmYXVs
dDoNCgkJCQkJcmV0dXJuOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCXZhciBfZ2VuZXJhdGVPcmlnaW5J
ZCA9IGZ1bmN0aW9uKCl7DQoJCXZhciB0aW1lc3RhbXAgPSAoKG5ldyBEYXRlKCkpLmdldFRpbWUo
KSkudG9TdHJpbmcoKTsNCgkJdmFyIHJhbmRvbSA9IChwYXJzZUludChNYXRoLnJhbmRvbSgpKjEw
MDAwMDApKS50b1N0cmluZygpOw0KCQlyZXR1cm4gcGFyc2VJbnQodGltZXN0YW1wLnN1YnN0cih0
aW1lc3RhbXAubGVuZ3RoLTcsdGltZXN0YW1wLmxlbmd0aC0xKSArIHJhbmRvbSk7DQoJfTsNCg0K
DQoJLy8vLy8vLy8vLy8vLy8vDQoJLy8gUFJPVE9DT0wNCgkvLy8vLy8vLy8vLy8vLw0KDQoJdmFy
IF9oZWxsb0F0dGVtcHRzOw0KCXZhciBNQVhfSEVMTE9fQVRURU1QVFMgPSA0MDsNCgl2YXIgX2hl
bGxvVGltZW91dDsNCg0KCXZhciBfaW5pdEhlbGxvRXhjaGFuZ2UgPSBmdW5jdGlvbigpew0KCQly
ZWdpc3RlckNhbGxiYWNrKCJzdG9wSGVsbG9FeGNoYW5nZSIsIGZ1bmN0aW9uKCl7DQoJCQlpZihf
aGVsbG9UaW1lb3V0KXsNCgkJCQljbGVhclRpbWVvdXQoX2hlbGxvVGltZW91dCk7DQoJCQl9DQoJ
CX0pOw0KDQoJCV9oZWxsb0F0dGVtcHRzID0gMDsNCgkJX2hlbGxvVGltZW91dCA9IHNldEludGVy
dmFsKGZ1bmN0aW9uKCl7DQoJCQlfc2F5SGVsbG8oKTsNCgkJfSwxMjUwKTsNCg0KCQlfc2F5SGVs
bG8oKTsNCgl9Ow0KDQoJdmFyIF9zYXlIZWxsbyA9IGZ1bmN0aW9uKCl7DQoJCXZhciBoZWxsb01l
c3NhZ2UgPSBfY3JlYXRlUHJvdG9jb2xNZXNzYWdlKCJvbklmcmFtZU1lc3NlbmdlckhlbGxvIik7
DQoJCV9zZW5kTWVzc2FnZShoZWxsb01lc3NhZ2UpOw0KCQlfaGVsbG9BdHRlbXB0cysrOw0KCQlp
ZigoX2hlbGxvQXR0ZW1wdHM+PU1BWF9IRUxMT19BVFRFTVBUUykmJihfaGVsbG9UaW1lb3V0KSl7
DQoJCQljbGVhclRpbWVvdXQoX2hlbGxvVGltZW91dCk7DQoJCX0NCgl9Ow0KDQoJdmFyIF9jcmVh
dGVQcm90b2NvbE1lc3NhZ2UgPSBmdW5jdGlvbihwcm90b2NvbE1lc3NhZ2UsZGVzdGluYXRpb24s
ZGVzdGluYXRpb25JZCl7DQoJCXZhciBkYXRhID0ge307DQoJCWRhdGEubWVzc2FnZSA9IHByb3Rv
Y29sTWVzc2FnZTsNCgkJcmV0dXJuIF9jcmVhdGVNZXNzYWdlKCJQUk9UT0NPTCIsZGF0YSxkZXN0
aW5hdGlvbixkZXN0aW5hdGlvbklkKTsNCgl9Ow0KDQoJdmFyIF9wcm9jZXNzUHJvdG9jb2xNZXNz
YWdlID0gZnVuY3Rpb24ocHJvdG9jb2xNZXNzYWdlKXsNCgkJaWYoKHByb3RvY29sTWVzc2FnZS5k
YXRhKSYmKHByb3RvY29sTWVzc2FnZS5kYXRhLm1lc3NhZ2UgPT09ICJvbklmcmFtZU1lc3Nlbmdl
ckhlbGxvIikpew0KCQkJaWYoIV9jb25uZWN0ZWQpew0KCQkJCV9jb25uZWN0ZWQgPSB0cnVlOw0K
CQkJCWlmKHR5cGVvZiBfbGlzdGVuZXJzWyJzdG9wSGVsbG9FeGNoYW5nZSJdID09ICJmdW5jdGlv
biIpew0KCQkJCQlfbGlzdGVuZXJzWyJzdG9wSGVsbG9FeGNoYW5nZSJdKCk7DQoJCQkJfQ0KCQkJ
CWlmKHR5cGVvZiBfbGlzdGVuZXJzWyJvbkNvbm5lY3QiXSA9PSAiZnVuY3Rpb24iKXsNCgkJCQkJ
X2xpc3RlbmVyc1sib25Db25uZWN0Il0ocHJvdG9jb2xNZXNzYWdlLm9yaWdpbik7DQoJCQkJfQ0K
CQkJfQ0KCQl9DQoJfTsNCg0KCS8vLy8vLy8vLy8vLy8vLw0KCS8vIFZFIE1lc3NhZ2VzDQoJLy8v
Ly8vLy8vLy8vLy8NCg0KCXZhciBfY3JlYXRlVkVNZXNzYWdlID0gZnVuY3Rpb24oVkVldmVudCxw
YXJhbXMsb3JpZ2luLGRlc3RpbmF0aW9uLGRlc3RpbmF0aW9uSWQpew0KCQl2YXIgZGF0YSA9IHt9
Ow0KCQlkYXRhLlZFZXZlbnQgPSBWRWV2ZW50Ow0KCQlkYXRhLnBhcmFtcyA9IHBhcmFtczsNCgkJ
cmV0dXJuIF9jcmVhdGVNZXNzYWdlKCJWRSIsZGF0YSxkZXN0aW5hdGlvbixkZXN0aW5hdGlvbklk
KTsNCgl9Ow0KDQoJdmFyIF9kZWZpbmVWRUNvbnN0YW50cyA9IGZ1bmN0aW9uKCl7DQoJCVZJU0gu
Q29uc3RhbnQgPSBWSVNILkNvbnN0YW50IHx8IHt9Ow0KCQlWSVNILkNvbnN0YW50LkV2ZW50ID0g
VklTSC5Db25zdGFudC5FdmVudCB8fCB7fTsNCgkJVklTSC5Db25zdGFudC5FdmVudC5vblNlbmRJ
ZnJhbWVNZXNzYWdlID0gIm9uU2VuZElmcmFtZU1lc3NhZ2UiOw0KCQlWSVNILkNvbnN0YW50LkV2
ZW50Lm9uR29Ub1NsaWRlID0gIm9uR29Ub1NsaWRlIjsNCgkJVklTSC5Db25zdGFudC5FdmVudC5v
bkVudGVyU2xpZGUgPSAib25FbnRlclNsaWRlIjsNCgkJVklTSC5Db25zdGFudC5FdmVudC5vblBs
YXlWaWRlbyA9ICJvblBsYXlWaWRlbyI7DQoJCVZJU0guQ29uc3RhbnQuRXZlbnQub25QYXVzZVZp
ZGVvID0gIm9uUGF1c2VWaWRlbyI7DQoJCVZJU0guQ29uc3RhbnQuRXZlbnQub25TZWVrVmlkZW8g
PSAib25TZWVrVmlkZW8iOw0KCQlWSVNILkNvbnN0YW50LkV2ZW50Lm9uUGxheUF1ZGlvID0gIm9u
UGxheUF1ZGlvIjsNCgkJVklTSC5Db25zdGFudC5FdmVudC5vblBhdXNlQXVkaW8gPSAib25QYXVz
ZUF1ZGlvIjsNCgkJVklTSC5Db25zdGFudC5FdmVudC5vblNlZWtBdWRpbyA9ICJvblNlZWtBdWRp
byI7DQoJCVZJU0guQ29uc3RhbnQuRXZlbnQub25TdWJzbGlkZU9wZW4gPSAib25TdWJzbGlkZU9w
ZW4iOw0KCQlWSVNILkNvbnN0YW50LkV2ZW50Lm9uU3Vic2xpZGVDbG9zZWQgPSAib25TdWJzbGlk
ZUNsb3NlZCI7DQoJCVZJU0guQ29uc3RhbnQuRXZlbnQub25BbnN3ZXJRdWl6ID0gIm9uQW5zd2Vy
UXVpeiI7DQoJCVZJU0guQ29uc3RhbnQuRXZlbnQub25TZXRTbGF2ZSA9ICJvblNldFNsYXZlIjsN
CgkJVklTSC5Db25zdGFudC5FdmVudC5hbGxvd0V4aXRXaXRob3V0Q29uZmlybWF0aW9uID0gImFs
bG93RXhpdFdpdGhvdXRDb25maXJtYXRpb24iOw0KCQlWSVNILkNvbnN0YW50LkV2ZW50LmV4aXQg
PSAiZXhpdCI7DQoJCVZJU0guQ29uc3RhbnQuRXZlbnQub25TZWxlY3RlZFNsaWRlcyA9ICJvblNl
bGVjdGVkU2xpZGVzIjsNCgkJVklTSC5Db25zdGFudC5FdmVudC5vblZFRm9jdXNDaGFuZ2UgPSAi
b25WRUZvY3VzQ2hhbmdlIjsNCgkJVklTSC5Db25zdGFudC5FdmVudC5vblRyYWNrZWRBY3Rpb24g
PSAib25UcmFja2VkQWN0aW9uIjsNCgl9Ow0KDQoJdmFyIF9hZnRlckNvbm5lY3RFeHRlcm5hbCA9
IGZ1bmN0aW9uKG9yaWdpbil7DQoJCWlmKF9vcHRpb25zKXsNCgkJCWlmKF9vcHRpb25zLnByZXZl
bnREZWZhdWx0PT09dHJ1ZSl7DQoJCQkJX3NlbmRQcmV2ZW50RGVmYXVsdHModHJ1ZSxvcmlnaW4p
Ow0KCQkJfQ0KCQl9DQoJfTsNCg0KCXZhciBfc2VuZFByZXZlbnREZWZhdWx0cyA9IGZ1bmN0aW9u
KHByZXZlbnREZWZhdWx0cyxkZXN0aW5hdGlvbil7DQoJCXZhciBwcmV2ZW50RGVmYXVsdFZFTWVz
c2FnZTsNCgkJaWYocHJldmVudERlZmF1bHRzPT09dHJ1ZSl7DQoJCQlwcmV2ZW50RGVmYXVsdFZF
TWVzc2FnZSA9IF9jcmVhdGVQcm90b2NvbE1lc3NhZ2UoImVuYWJsZVByZXZlbnREZWZhdWx0Iik7
DQoJCX0gZWxzZSB7DQoJCQlwcmV2ZW50RGVmYXVsdFZFTWVzc2FnZSA9IF9jcmVhdGVQcm90b2Nv
bE1lc3NhZ2UoImRpc2FibGVQcmV2ZW50RGVmYXVsdCIpOw0KCQl9DQoJCXNlbmRNZXNzYWdlKHBy
ZXZlbnREZWZhdWx0VkVNZXNzYWdlKTsNCgl9Ow0KDQoJdmFyIF9wcm9jZXNzVkVNZXNzYWdlID0g
ZnVuY3Rpb24oVkVNZXNzYWdlKXsNCg0KCQl2YXIgZGF0YSA9IFZFTWVzc2FnZS5kYXRhOw0KDQoJ
CS8vIm9uTWVzc2FnZSIgY2FsbGJhY2sNCgkJaWYoX2xpc3RlbmVyc1sib25NZXNzYWdlIl0pew0K
CQkJX2xpc3RlbmVyc1sib25NZXNzYWdlIl0oSlNPTi5zdHJpbmdpZnkoVkVNZXNzYWdlKSxWRU1l
c3NhZ2Uub3JpZ2luKTsNCgkJfQ0KDQoJCXZhciBjYWxsYmFjayA9IF9saXN0ZW5lcnNbZGF0YS5W
RWV2ZW50XTsNCgkJaWYoIWNhbGxiYWNrKXsNCgkJCS8vTm9ib2R5IGxpc3RlbiB0byB0aGlzIGV2
ZW50DQoJCQlyZXR1cm47DQoJCX0NCg0KCQlzd2l0Y2goZGF0YS5WRWV2ZW50KXsNCgkJCWNhc2Ug
VklTSC5Db25zdGFudC5FdmVudC5vbkdvVG9TbGlkZToNCgkJCQlpZihkYXRhLnBhcmFtcyl7DQoJ
CQkJCWNhbGxiYWNrKGRhdGEucGFyYW1zLnNsaWRlTnVtYmVyLFZFTWVzc2FnZS5vcmlnaW4pOw0K
CQkJCX0NCgkJCQlicmVhazsNCgkJCWNhc2UgVklTSC5Db25zdGFudC5FdmVudC5vblBsYXlWaWRl
bzoNCgkJCQlpZihkYXRhLnBhcmFtcyl7DQoJCQkJCWNhbGxiYWNrKGRhdGEucGFyYW1zLnZpZGVv
SWQsDQoJCQkJCQkJIGRhdGEucGFyYW1zLmN1cnJlbnRUaW1lLGRhdGEucGFyYW1zLnNsaWRlTnVt
YmVyLA0KCQkJCQkJCSBWRU1lc3NhZ2Uub3JpZ2luKTsNCgkJCQl9DQoJCQkJYnJlYWs7DQoJCQlj
YXNlIFZJU0guQ29uc3RhbnQuRXZlbnQub25QYXVzZVZpZGVvOg0KCQkJCWlmKGRhdGEucGFyYW1z
KXsNCgkJCQkJY2FsbGJhY2soZGF0YS5wYXJhbXMudmlkZW9JZCwNCgkJCQkJCQkgZGF0YS5wYXJh
bXMuY3VycmVudFRpbWUsZGF0YS5wYXJhbXMuc2xpZGVOdW1iZXIsDQoJCQkJCQkJIFZFTWVzc2Fn
ZS5vcmlnaW4pOw0KCQkJCX0NCgkJCQlicmVhazsNCgkJCWNhc2UgVklTSC5Db25zdGFudC5FdmVu
dC5vblNlZWtWaWRlbzoNCgkJCQlpZihkYXRhLnBhcmFtcyl7DQoJCQkJCWNhbGxiYWNrKGRhdGEu
cGFyYW1zLnZpZGVvSWQsDQoJCQkJCQkJIGRhdGEucGFyYW1zLmN1cnJlbnRUaW1lLGRhdGEucGFy
YW1zLnNsaWRlTnVtYmVyLA0KCQkJCQkJCSBWRU1lc3NhZ2Uub3JpZ2luKTsNCgkJCQl9DQoJCQkJ
YnJlYWs7DQoJCQljYXNlIFZJU0guQ29uc3RhbnQuRXZlbnQub25TdWJzbGlkZU9wZW46DQoJCQkJ
aWYoZGF0YS5wYXJhbXMpew0KCQkJCQljYWxsYmFjayhkYXRhLnBhcmFtcy5zbGlkZUlkLA0KCQkJ
CQkJCSBWRU1lc3NhZ2Uub3JpZ2luKTsNCgkJCQl9DQoJCQkJYnJlYWs7DQoJCQljYXNlIFZJU0gu
Q29uc3RhbnQuRXZlbnQub25TdWJzbGlkZUNsb3NlZDoNCgkJCQlpZihkYXRhLnBhcmFtcyl7DQoJ
CQkJCWNhbGxiYWNrKGRhdGEucGFyYW1zLnNsaWRlSWQsDQoJCQkJCQkJIFZFTWVzc2FnZS5vcmln
aW4pOw0KCQkJCX0NCgkJCQlicmVhazsNCgkJCWNhc2UgVklTSC5Db25zdGFudC5FdmVudC5vblZF
Rm9jdXNDaGFuZ2U6DQoJCQkJaWYoZGF0YS5wYXJhbXMpew0KCQkJCQljYWxsYmFjayhkYXRhLnBh
cmFtcy5mb2N1cyxWRU1lc3NhZ2Uub3JpZ2luKTsNCgkJCQl9DQoJCQkJYnJlYWs7DQoJCQlkZWZh
dWx0Og0KCQkJCV9wcmludCgiVklTSC5NZXNzZW5nZXIuUHJvY2Vlc29yIEVycm9yOiBVbnJlY29n
bml6ZWQgZXZlbnQ6ICIgKyBkYXRhLlZFZXZlbnQpOw0KCQkJCWJyZWFrOw0KCQl9DQoJfTsNCg0K
CQ0KCS8vLy8vLy8vLy8vLw0KCS8vIFZFIEFQSQ0KCS8vLy8vLy8vLy8vCQ0KDQoJdmFyIGdvVG9T
bGlkZSA9IGZ1bmN0aW9uKHNsaWRlTnVtYmVyKXsNCgkJdmFyIHBhcmFtcyA9IHt9Ow0KCQlwYXJh
bXMuc2xpZGVOdW1iZXIgPSBzbGlkZU51bWJlcjsNCgkJdmFyIFZFTWVzc2FnZSA9IF9jcmVhdGVW
RU1lc3NhZ2UoVklTSC5Db25zdGFudC5FdmVudC5vbkdvVG9TbGlkZSxwYXJhbXMpOw0KCQlzZW5k
TWVzc2FnZShWRU1lc3NhZ2UpOw0KCX07DQoNCgl2YXIgcGxheVZpZGVvID0gZnVuY3Rpb24odmlk
ZW9JZCxjdXJyZW50VGltZSx2aWRlb1NsaWRlTnVtYmVyKXsNCgkJdmFyIHBhcmFtcyA9IHt9Ow0K
CQlwYXJhbXMudmlkZW9JZCA9IHZpZGVvSWQ7DQoJCXBhcmFtcy5jdXJyZW50VGltZSA9IGN1cnJl
bnRUaW1lOw0KCQlwYXJhbXMuc2xpZGVOdW1iZXIgPSB2aWRlb1NsaWRlTnVtYmVyOw0KCQl2YXIg
VkVNZXNzYWdlID0gX2NyZWF0ZVZFTWVzc2FnZShWSVNILkNvbnN0YW50LkV2ZW50Lm9uUGxheVZp
ZGVvLHBhcmFtcyk7DQoJCXNlbmRNZXNzYWdlKFZFTWVzc2FnZSk7DQoJfTsNCg0KCXZhciBwYXVz
ZVZpZGVvID0gZnVuY3Rpb24odmlkZW9JZCxjdXJyZW50VGltZSx2aWRlb1NsaWRlTnVtYmVyKXsN
CgkJdmFyIHBhcmFtcyA9IHt9Ow0KCQlwYXJhbXMudmlkZW9JZCA9IHZpZGVvSWQ7DQoJCXBhcmFt
cy5jdXJyZW50VGltZSA9IGN1cnJlbnRUaW1lOw0KCQlwYXJhbXMuc2xpZGVOdW1iZXIgPSB2aWRl
b1NsaWRlTnVtYmVyOw0KCQl2YXIgVkVNZXNzYWdlID0gX2NyZWF0ZVZFTWVzc2FnZShWSVNILkNv
bnN0YW50LkV2ZW50Lm9uUGF1c2VWaWRlbyxwYXJhbXMpOw0KCQlzZW5kTWVzc2FnZShWRU1lc3Nh
Z2UpOw0KCX07DQoNCgl2YXIgc2Vla1ZpZGVvID0gZnVuY3Rpb24odmlkZW9JZCxjdXJyZW50VGlt
ZSx2aWRlb1NsaWRlTnVtYmVyKXsNCgkJdmFyIHBhcmFtcyA9IHt9Ow0KCQlwYXJhbXMudmlkZW9J
ZCA9IHZpZGVvSWQ7DQoJCXBhcmFtcy5jdXJyZW50VGltZSA9IGN1cnJlbnRUaW1lOw0KCQlwYXJh
bXMuc2xpZGVOdW1iZXIgPSB2aWRlb1NsaWRlTnVtYmVyOw0KCQl2YXIgVkVNZXNzYWdlID0gX2Ny
ZWF0ZVZFTWVzc2FnZShWSVNILkNvbnN0YW50LkV2ZW50Lm9uU2Vla1ZpZGVvLHBhcmFtcyk7DQoJ
CXNlbmRNZXNzYWdlKFZFTWVzc2FnZSk7DQoJfTsNCg0KCXZhciBvcGVuU3Vic2xpZGUgPSBmdW5j
dGlvbihzbGlkZUlkKXsNCgkJdmFyIHBhcmFtcyA9IHt9Ow0KCQlwYXJhbXMuc2xpZGVJZCA9IHNs
aWRlSWQ7DQoJCXZhciBWRU1lc3NhZ2UgPSBfY3JlYXRlVkVNZXNzYWdlKFZJU0guQ29uc3RhbnQu
RXZlbnQub25TdWJzbGlkZU9wZW4scGFyYW1zKTsNCgkJc2VuZE1lc3NhZ2UoVkVNZXNzYWdlKTsN
Cgl9Ow0KDQoJdmFyIGNsb3NlU3Vic2xpZGUgPSBmdW5jdGlvbihzbGlkZUlkKXsNCgkJdmFyIHBh
cmFtcyA9IHt9Ow0KCQlwYXJhbXMuc2xpZGVJZCA9IHNsaWRlSWQ7DQoJCXZhciBWRU1lc3NhZ2Ug
PSBfY3JlYXRlVkVNZXNzYWdlKFZJU0guQ29uc3RhbnQuRXZlbnQub25TdWJzbGlkZUNsb3NlZCxw
YXJhbXMpOw0KCQlzZW5kTWVzc2FnZShWRU1lc3NhZ2UpOw0KCX07DQoNCgl2YXIgc2V0U2xhdmUg
PSBmdW5jdGlvbihzbGF2ZSxpZnJhbWVJZCl7DQoJCXZhciBwYXJhbXMgPSB7fTsNCgkJcGFyYW1z
LnNsYXZlID0gc2xhdmU7DQoJCXZhciBWRU1lc3NhZ2UgPSBfY3JlYXRlVkVNZXNzYWdlKFZJU0gu
Q29uc3RhbnQuRXZlbnQub25TZXRTbGF2ZSxwYXJhbXMpOw0KCQlzZW5kTWVzc2FnZShWRU1lc3Nh
Z2UsaWZyYW1lSWQpOw0KCX07DQoNCgl2YXIgc2V0TWFzdGVyID0gZnVuY3Rpb24obWFzdGVyKXsN
CgkJdmFyIHBhcmFtcyA9IHt9Ow0KCQl2YXIgYWxsVkVJZnJhbWVzID0gZG9jdW1lbnQucXVlcnlT
ZWxlY3RvckFsbCgiLnZpc2hFZGl0b3JJZnJhbWUiKTsNCgkJZm9yKHZhciBpPTA7IGk8YWxsVkVJ
ZnJhbWVzLmxlbmd0aDsgaSsrKXsNCgkJCWlmKGFsbFZFSWZyYW1lc1tpXS5pZCE9PW1hc3Rlcil7
DQoJCQkJcGFyYW1zLnNsYXZlID0gdHJ1ZTsNCgkJCX0gZWxzZSB7DQoJCQkJcGFyYW1zLnNsYXZl
ID0gZmFsc2U7DQoJCQl9DQoJCQl2YXIgaWZyYW1lSWQgPSBhbGxWRUlmcmFtZXNbaV0uaWQ7DQoJ
CQl2YXIgVkVNZXNzYWdlID0gX2NyZWF0ZVZFTWVzc2FnZShWSVNILkNvbnN0YW50LkV2ZW50Lm9u
U2V0U2xhdmUscGFyYW1zKTsNCgkJCXNlbmRNZXNzYWdlKFZFTWVzc2FnZSxpZnJhbWVJZCk7DQoJ
CX0NCgl9Ow0KDQoJdmFyIGFsbG93RXhpdFdpdGhvdXRDb25maXJtYXRpb24gPSBmdW5jdGlvbigp
ew0KCQl2YXIgcGFyYW1zID0ge307DQoJCXZhciBWRU1lc3NhZ2UgPSBfY3JlYXRlVkVNZXNzYWdl
KFZJU0guQ29uc3RhbnQuRXZlbnQuYWxsb3dFeGl0V2l0aG91dENvbmZpcm1hdGlvbixwYXJhbXMp
Ow0KCQlzZW5kTWVzc2FnZShWRU1lc3NhZ2UpOw0KCX07DQoNCg0KCS8vLy8vLy8vLy8vLy8vLw0K
CS8vIFdBUFAgTWVzc2FnZXMNCgkvLy8vLy8vLy8vLy8vLw0KDQoJdmFyIF9jcmVhdGVXQVBQTWVz
c2FnZSA9IGZ1bmN0aW9uKG1ldGhvZCxwYXJhbXMsb3JpZ2luLGRlc3RpbmF0aW9uLGRlc3RpbmF0
aW9uSWQpew0KCQl2YXIgZGF0YSA9IHt9Ow0KCQlkYXRhLm1ldGhvZCA9IG1ldGhvZDsNCgkJZGF0
YS5wYXJhbXMgPSBwYXJhbXM7DQoJCXJldHVybiBfY3JlYXRlTWVzc2FnZSgiV0FQUCIsZGF0YSxk
ZXN0aW5hdGlvbixkZXN0aW5hdGlvbklkKTsNCgl9Ow0KDQoJdmFyIF9wcm9jZXNzV0FQUE1lc3Nh
Z2UgPSBmdW5jdGlvbihXQVBQTWVzc2FnZSl7DQoJCXZhciBkYXRhID0gV0FQUE1lc3NhZ2UuZGF0
YTsNCg0KCQlpZih0eXBlb2YgX3dhcHBsaXN0ZW5lcnNbZGF0YS5tZXRob2RdID09ICJmdW5jdGlv
biIpew0KCQkJX3dhcHBsaXN0ZW5lcnNbZGF0YS5tZXRob2RdKGRhdGEucGFyYW1zKTsNCgkJCV93
YXBwbGlzdGVuZXJzW2RhdGEubWV0aG9kXSA9IHVuZGVmaW5lZDsNCgkJfTsNCgl9Ow0KDQoJLy8v
Ly8vLy8vLy8vLy8vDQoJLy8gV0FQUCBBUEkNCgkvLy8vLy8vLy8vLy8vLw0KDQoJdmFyIGdldFVz
ZXIgPSBmdW5jdGlvbihjYWxsYmFjayl7DQoJCV9jYWxsV0FQUE1ldGhvZCgiZ2V0VXNlciIse30s
Y2FsbGJhY2spOw0KCX07DQoNCgl2YXIgZ2V0QXV0aFRva2VuID0gZnVuY3Rpb24oY2FsbGJhY2sp
ew0KCQlfY2FsbFdBUFBNZXRob2QoImdldEF1dGhUb2tlbiIse30sY2FsbGJhY2spOw0KCX07DQoN
Cgl2YXIgc2V0U2NvcmUgPSBmdW5jdGlvbihzY29yZSxjYWxsYmFjayl7DQoJCV9jYWxsV0FQUE1l
dGhvZCgic2V0U2NvcmUiLHNjb3JlLGNhbGxiYWNrKTsNCgl9Ow0KDQoJdmFyIHNldFByb2dyZXNz
ID0gZnVuY3Rpb24ocHJvZ3Jlc3MsY2FsbGJhY2spew0KCQlfY2FsbFdBUFBNZXRob2QoInNldFBy
b2dyZXNzIixwcm9ncmVzcyxjYWxsYmFjayk7DQoJfTsNCg0KCXZhciBzZXRTdWNjZXNzU3RhdHVz
ID0gZnVuY3Rpb24oc3RhdHVzLGNhbGxiYWNrKXsNCgkJX2NhbGxXQVBQTWV0aG9kKCJzZXRTdWNj
ZXNzU3RhdHVzIixzdGF0dXMsY2FsbGJhY2spOw0KCX07DQoNCgl2YXIgc2V0Q29tcGxldGlvblN0
YXR1cyA9IGZ1bmN0aW9uKHN0YXR1cyxjYWxsYmFjayl7DQoJCV9jYWxsV0FQUE1ldGhvZCgic2V0
Q29tcGxldGlvblN0YXR1cyIsc3RhdHVzLGNhbGxiYWNrKTsNCgl9Ow0KDQoJdmFyIF9jYWxsV0FQ
UE1ldGhvZCA9IGZ1bmN0aW9uKG1ldGhvZE5hbWUscGFyYW1zLGNhbGxiYWNrKXsNCgkJaWYodHlw
ZW9mIHBhcmFtcyA9PSAidW5kZWZpbmVkIil7DQoJCQlwYXJhbXMgPSB7fTsNCgkJfQ0KDQoJCV93
YXBwbGlzdGVuZXJzW21ldGhvZE5hbWVdID0gY2FsbGJhY2s7DQoJCXZhciBXQVBQTWVzc2FnZSA9
IF9jcmVhdGVXQVBQTWVzc2FnZShtZXRob2ROYW1lLHBhcmFtcyk7DQoJCXNlbmRNZXNzYWdlKFdB
UFBNZXNzYWdlKTsNCgl9Ow0KDQoJLy8vLy8vLy8vLy8vLy8vDQoJLy8gVHJhY2tlcg0KCS8vLy8v
Ly8vLy8vLy8vDQoNCglfdHJhY2tlckVuYWJsZWQgPSBmYWxzZTsNCglfdHJhY2tlckV2ZW50c0xv
YWRlZCA9IGZhbHNlOw0KDQoJdmFyIGVuYWJsZVRyYWNrZXIgPSBmdW5jdGlvbigpew0KCQlfdHJh
Y2tlckVuYWJsZWQgPSB0cnVlOw0KCQlfbG9hZFRyYWNrZXJFdmVudHMoKTsNCgl9Ow0KDQoJdmFy
IF9sb2FkVHJhY2tlckV2ZW50cyA9IGZ1bmN0aW9uKCl7DQoJCWlmKF90cmFja2VyRXZlbnRzTG9h
ZGVkKXsNCgkJCXJldHVybjsNCgkJfQ0KCQlfdHJhY2tlckV2ZW50c0xvYWRlZCA9IHRydWU7DQoN
CgkJJChkb2N1bWVudCkuYmluZCgnY2xpY2snLCBmdW5jdGlvbihldmVudCl7DQoJCQl2YXIgcGFy
YW1zID0ge307DQoJCQlwYXJhbXNbIngiXSA9IGV2ZW50LmNsaWVudFg7DQoJCQlwYXJhbXNbInki
XSA9IGV2ZW50LmNsaWVudFk7DQoNCgkJCWlmKGV2ZW50LnRhcmdldCl7DQoJCQkJaWYoZXZlbnQu
dGFyZ2V0LnRhZ05hbWUpew0KCQkJCQlwYXJhbXNbInRhZ05hbWUiXSA9IGV2ZW50LnRhcmdldC50
YWdOYW1lDQoJCQkJfQ0KCQkJCWlmKGV2ZW50LnRhcmdldC5pZCl7DQoJCQkJCXBhcmFtc1siaWQi
XSA9IGV2ZW50LnRhcmdldC5pZA0KCQkJCX0NCgkJCX0NCg0KCQkJbm90aWZ5VHJhY2tlckFjdGlv
bigiY2xpY2siLHBhcmFtcyk7DQoJCX0pOw0KDQoJCSQoZG9jdW1lbnQpLmJpbmQoJ2tleWRvd24n
LCBmdW5jdGlvbihldmVudCl7DQoJCQl2YXIgcGFyYW1zID0ge307DQoJCQlwYXJhbXNbImtleUNv
ZGUiXSA9IGV2ZW50LmtleUNvZGU7DQoJCQlub3RpZnlUcmFja2VyQWN0aW9uKCJrZXlkb3duIixw
YXJhbXMpOw0KCQl9KTsNCgkJDQoJfTsNCg0KCXZhciBub3RpZnlUcmFja2VyQWN0aW9uID0gZnVu
Y3Rpb24oYWN0aW9uLGFjdGlvblBhcmFtcyl7DQoJCXZhciBkYXRhID0ge307DQoJCWRhdGEuYWN0
aW9uID0gYWN0aW9uOw0KCQlkYXRhLnBhcmFtcyA9IGFjdGlvblBhcmFtczsNCgkJdmFyIFdBUFBN
ZXNzYWdlID0gX2NyZWF0ZVdBUFBNZXNzYWdlKCJub3RpZnlUcmFja2VyQWN0aW9uIixkYXRhKTsN
CgkJc2VuZE1lc3NhZ2UoV0FQUE1lc3NhZ2UpOw0KCX07DQoNCg0KCS8vLy8vLy8vLy8vDQoJLy8g
VXRpbHMNCgkvLy8vLy8vLy8vLw0KDQoJdmFyIF9wcmludCA9IGZ1bmN0aW9uKG9iamVjdFRvUHJp
bnQpew0KCQlpZigoY29uc29sZSkmJihjb25zb2xlLmxvZykpew0KCQkJY29uc29sZS5sb2cob2Jq
ZWN0VG9QcmludCk7DQoJCX0NCgl9Ow0KDQoJdmFyIGlzQ29ubmVjdGVkID0gZnVuY3Rpb24oKXsN
CgkJcmV0dXJuIF9jb25uZWN0ZWQ7DQoJfTsNCg0KDQoJcmV0dXJuIHsNCgkJCWluaXQgCQkJCQkJ
CTogaW5pdCwNCg0KCQkJLy9WRSBtZXRob2RzDQoJCQlyZWdpc3RlckNhbGxiYWNrIAkJCQk6IHJl
Z2lzdGVyQ2FsbGJhY2ssDQoJCQl1blJlZ2lzdGVyQ2FsbGJhY2sgCQkJCTogdW5SZWdpc3RlckNh
bGxiYWNrLA0KCQkJc2VuZE1lc3NhZ2UJCQkJCQk6IHNlbmRNZXNzYWdlLA0KCQkJc2V0U2xhdmUJ
CQkJCQk6IHNldFNsYXZlLA0KCQkJc2V0TWFzdGVyCQkJCQkJOiBzZXRNYXN0ZXIsDQoJCQlhbGxv
d0V4aXRXaXRob3V0Q29uZmlybWF0aW9uIAk6IGFsbG93RXhpdFdpdGhvdXRDb25maXJtYXRpb24s
DQoJCQlnb1RvU2xpZGUgCQkJCQkJOiBnb1RvU2xpZGUsDQoJCQlwbGF5VmlkZW8gCQkJCQkJOiBw
bGF5VmlkZW8sDQoJCQlwYXVzZVZpZGVvIAkJCQkJCTogcGF1c2VWaWRlbywNCgkJCXNlZWtWaWRl
byAJCQkJCQk6IHNlZWtWaWRlbywNCgkJCW9wZW5TdWJzbGlkZQkJCQkJOiBvcGVuU3Vic2xpZGUs
DQoJCQljbG9zZVN1YnNsaWRlCQkJCQk6IGNsb3NlU3Vic2xpZGUsDQoNCgkJCS8vV0FQUCBtZXRo
b2RzDQoJCQlnZXRVc2VyCQkJCQkJCTogZ2V0VXNlciwNCgkJCXNldFNjb3JlCQkJCQkJOiBzZXRT
Y29yZSwNCgkJCXNldFByb2dyZXNzCQkJCQkJOiBzZXRQcm9ncmVzcywNCgkJCXNldFN1Y2Nlc3NT
dGF0dXMJCQkJOiBzZXRTdWNjZXNzU3RhdHVzLA0KCQkJc2V0Q29tcGxldGlvblN0YXR1cwkJCQk6
IHNldENvbXBsZXRpb25TdGF0dXMsDQoJCQlnZXRBdXRoVG9rZW4JCQkJCTogZ2V0QXV0aFRva2Vu
LA0KDQoJCQkvL1RyYWNraW5nIFN5c3RlbQ0KCQkJZW5hYmxlVHJhY2tlcgkJCQkJOiBlbmFibGVU
cmFja2VyLA0KCQkJbm90aWZ5VHJhY2tlckFjdGlvbgkJCQk6IG5vdGlmeVRyYWNrZXJBY3Rpb24s
DQoNCgkJCS8vVXRpbHMNCgkJCWlzQ29ubmVjdGVkCQkJCQkJOiBpc0Nvbm5lY3RlZA0KCX07DQoN
Cn0pIChWSVNIKTs=
</content>
  </attachment>
  <object>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <name>MOOC.Code.MOOCSheet</name>
    <number>0</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>cf8ffc48-917f-402d-b9db-f0993937336f</guid>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>require(['jquery', 'xwiki-meta'], function($, xm) {
  #set ($configRef = $services.model.createDocumentReference("", ["MOOC", "Code"], "Configuration"))
  #set ($configDoc = $xwiki.getDocument($configRef))
  #set ($config = $configDoc.getObject("MOOC.Code.ConfigurationClass"))
  #set ($vishUrl = $config.getProperty('vishServer').value)
  var displayError = function (err) {
    console.log(err);
    $('#vish_error').text(err);
  };

  // Get the domain from the server URL (remove http://)
  var vishOrigin = "$vishUrl";
  var vishDomainArr = vishOrigin.match(/https?:\/\/(.+)$/);

  if (vishDomainArr.length &lt; 2) { displayError("Unable to extract the vish domain from the server URL : " + vishOrigin); return; }
  var vishDomain = vishDomainArr[1];

  var button = $('#vish_get_avatar');
  var id = $(button).attr('data-id');

  // Store the value
  var storeAvatar = function(url) {
    var avatarUrl = url.split('?')[0];
    $.ajax({
      url: xm.restURL+"/objects/MOOC.Code.MOOCClass/0/properties/avatar_url",
      type: "PUT",
      contentType: "text/plain",
      data: avatarUrl
    }).done(function (data) {
      var img = '&lt;img src="' + avatarUrl + '" width="200" title="Excursion ' + id + '" alt="excursion_avatar" /&gt;';
      $('#vish_avatar').html(img);
      // Fill the field in edit mode:
      if (document.getElementById('MOOC.Code.MOOCClass_0_avatar_url')) {
        document.getElementById('MOOC.Code.MOOCClass_0_avatar_url').value = avatarUrl;
      }
    }).fail(function (xhr, err) {
      displayError(err);
    });
  }

  var onClick = function(e) {
    e.preventDefault();
    // The search API uses special id : "Excursion:{excursionID}@{domain}
    var searchId = "Excursion:"+id+"@92.222.135.194:3000";
    // Process the query
    $.ajax({
      url: vishOrigin+"/apis/search?id="+searchId,
      type: "GET",
      dataType: "json"
    }).done(function (data){
      if (data &amp;&amp; data.avatar_url) {
        storeAvatar(data.avatar_url);
        return;
      }
      displayError("Unable to find the avatar in VISH");
    }).fail(function (xhr, err) {
      displayError(err);
    });
  };

  $(button).on('click', onClick);
});</code>
    </property>
    <property>
      <name>Get course avatar</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>6</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>3</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>1</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>5</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>4</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <name>MOOC.Code.MOOCSheet</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>8c271319-00cc-41f1-9715-4fcac5b69db3</guid>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>#vish_avatar {
  display: inline-block;
  margin-right: 100px;
  vertical-align: top;
}

#vish_metadata {
  display: inline-block;
  vertical-align: top;
}</code>
    </property>
    <property>
      <contentType>CSS</contentType>
    </property>
    <property>
      <name>MOOC CSS</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
  <content>{{velocity}}
#set ($obj = $doc.getObject('MOOC.Code.MOOCClass'))
#if ($doc.isNew())
  $obj.set("name", $doc.name)
  $doc.save()
  $response.sendRedirect($doc.getURL("view"))
#end
## Get the vish server URL
#set ($configRef = $services.model.createDocumentReference("", ["MOOC", "Code"], "Configuration"))
#set ($configDoc = $xwiki.getDocument($configRef))
#set ($config = $configDoc.getObject("MOOC.Code.ConfigurationClass"))
#set ($vishUrl = $config.getProperty('vishServer').value)
#if(!$vishUrl.endsWith("/"))
  #set ($vishUrl = "${vishUrl}/")
#end
##
#if ("$!vishUrl" != "")
##
  #set ($cId = $obj.getProperty("vishId").value)
  #set ($cAvatar = $obj.getProperty("avatar_url").value)
##
  #if ("$!cId" == "")
    ## Ask for the course id
    {{html wiki="false"}}
      &lt;form method="get" target="_blank" action="${vishUrl}excursions/new"&gt;
      &lt;input type="submit" class="btn btn-success" value="Create New Course" /&gt;
      &lt;/form&gt;
    {{/html}}
  #elseif($hasEdit || "$!cAvatar" != "")
    #set ($discard = $xwiki.jsx.use("MOOC.Code.MOOCSheet"))
    #set ($discard = $xwiki.ssx.use("MOOC.Code.MOOCSheet"))
    ## Get the avatar
    (% id="vish_avatar" %) (((
    #if ("$!cAvatar" == "")
      {{html wiki="false"}}
        &lt;button id="vish_get_avatar" class="btn btn-primary" data-id="$cId"&gt;Get the avatar from VISH&lt;/button&gt;
      {{/html}}
    #else
      [[image:$!cAvatar||width="200"]]
    #end
    )))
  #end
## Display item data
(% id="vish_metadata" %) (((
**Course Name** : $doc.display("name")
**Vish Course ID** : $doc.display("vishId")
#if ($xcontext.action == "edit" &amp;&amp; "$!cId" != "")
**Avatar URL** : $doc.display("avatar_url")
#end
)))
##
  #if ("$!cId" == "")
    {{info}}Please edit the page to add the course ID from Vish if you want to find course information here{{/info}}
  #else
    #set ($uploadRef = $services.model.createDocumentReference("", ["MOOC", "Excursions"], "$cId"))
    #set ($uploadDoc = $xwiki.getDocument($uploadRef))
    #if (!$uploadDoc.isNew())
      #set ($attachList = $uploadDoc.getAttachmentList())
      #if ($attachList.size() &gt; 0)
        #set ($Integer = 0)
        === Uploaded courses ===
        #foreach ($attach in $attachList)
          #set ($fileName = $attach.getFilename())
          #set ($index = $fileName.lastIndexOf('.'))
          #if ($index &gt; 0)
            #set ($name = $fileName.substring(0,$index))
            #set ($name = $numbertool.toNumber($name))
            #set ($name = $datetool.format($name))
          #end
          #if ("$!name" == "")
            #set ($name = $fileName)
          #end
          [[$name&gt;&gt;path:$uploadDoc.getAttachmentURL($fileName)]]
        #end
      #end
    #end
##
    === View the course on VISH ===
    [[View course $cId&gt;&gt;url:${vishUrl}excursions/$cId||target="_blank"]]
  #end
#else
  Your wiki administrator has to configure the URL of the Vish server in the wiki administration if you want to create a new course from here.
#end
{{/velocity}}</content>
</xwikidoc>
